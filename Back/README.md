<<<<<<< HEAD
# AI Помощник Бухгалтера - Backend

Backend часть интеллектуального приложения для автоматической классификации документов бухгалтерского учета в Молдове.

## 🚀 Возможности Backend

### 🇲🇩 📥 МОДУЛЬ 1: «Импорт и преобразование документов»
- **Фото → PDF / Excel**: Конвертация изображений документов
- **OCR с поддержкой румынского и русского языков**: Tesseract + OpenAI Vision API
- **Авто-конвертация в PDF**: С нужной структурой для печати
- **Экспорт таблиц в CSV / XLSX**: Для бухгалтерии или отчётов в FISC

### 🇲🇩 🧾 МОДУЛЬ 2: «Распознавание и классификация по молдавским типам документов»
- **Factura fiscală**: Номер, дата, продавец/покупатель, IDNO, НДС, общая сумма
- **Bon fiscal (чек)**: Название товаров, количество, итоговая сумма, касса
- **Stat de plată**: Сотрудники, должности, зарплата, налоги, взносы
- **Act de achiziție**: Данные авто, сумма, покупатель/продавец
- **Ordin de plată**: Сумма, назначение, банк, IBAN
- **Raport de avans**: Сумма, дата, командировка, потрачено, остаток

### 🇲🇩 🧠 МОДУЛЬ 3: «Умный анализ документа»
- **Определение типа**: Автоматическое распознавание типа документа
- **Автоматическое суммирование**: Общая сумма НДС, итого и т.д.
- **Проверка реквизитов**: IDNO (13 цифр), даты, суммы
- **Выявление ошибок**: Несоответствие сумм, НДС не 20%, нет IDNO

### 🇲🇩 📤 МОДУЛЬ 4: «Экспорт и отчётность»
- **Генерация отчётов**: По всем обработанным документам
- **Экспорт в Excel/CSV**: Для загрузки в бухгалтерскую программу
- **PDF с печатной формой**: Подписать и отправить
- **JSON для API / ERP**: Интеграция с внешними системами
- **Отчеты для FISC**: Специальные форматы для налоговой службы

### 🇲🇩 📚 МОДУЛЬ 5: «Учёт и контроль»
- **Хранение истории**: Документы по датам, категориям, суммам
- **Поиск по IDNO, дате, сумме, типу документа**: Гибкая система поиска
- **Валидация форматов**: Проверка обязательных полей
- **База данных SQLite**: Надежное хранение данных

## 🛠️ Технологии

- **Framework**: FastAPI
- **Язык**: Python 3.11+
- **OCR**: Tesseract 5.5+
- **AI**: OpenAI Vision API
- **База данных**: SQLite
- **PDF обработка**: PyMuPDF
- **Изображения**: Pillow
- **Excel**: openpyxl, pandas

## 📋 Требования

### Системные требования
- Python 3.11 или 3.12 (рекомендуется)
- Tesseract OCR 5.5+
- 4GB RAM (минимум)
- 1GB свободного места

### Операционные системы
- ✅ macOS 10.15+
- ✅ Ubuntu 20.04+
- ✅ Windows 10+ (с WSL)
- ✅ CentOS 8+

## 🚀 Установка

### 1. Установка Tesseract OCR

**macOS:**
```bash
brew install tesseract tesseract-lang
```

**Ubuntu/Debian:**
```bash
sudo apt update
sudo apt install tesseract-ocr
sudo apt install tesseract-ocr-ron tesseract-ocr-rus tesseract-ocr-eng
```

**Windows:**
1. Скачайте установщик с [GitHub](https://github.com/UB-Mannheim/tesseract/wiki)
2. Установите и добавьте в PATH
3. Скачайте языковые пакеты для румынского, русского и английского

### 2. Установка Python зависимостей

```bash
# Создание виртуального окружения
python3 -m venv venv
source venv/bin/activate  # macOS/Linux
# или
venv\Scripts\activate  # Windows

# Установка зависимостей
pip install -r requirements.txt
```

### 3. Настройка OpenAI API

Создайте файл `.env` в корне проекта:
```env
OPENAI_API_KEY=your_openai_api_key_here
```

## 🚀 Запуск

### Разработка
```bash
python run.py --reload
```

### Продакшн
```bash
uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4
```

Приложение будет доступно по адресу: http://localhost:8000

## 📊 API Endpoints

### Основные эндпоинты

#### GET /
Главная страница с формой загрузки

#### POST /upload
Загрузка и обработка файла (старый формат)

#### POST /convert-to-pdf
Конвертация изображения в PDF

#### POST /convert-to-excel
Конвертация изображения в Excel (только через OpenAI Vision API)

### Новые эндпоинты для работы с документами

#### POST /documents/upload
Загружает и обрабатывает документ с сохранением в базу данных

#### GET /documents
Поиск документов по различным критериям

#### GET /documents/{doc_id}
Получает документ по ID

#### DELETE /documents/{doc_id}
Удаляет документ по ID

### Эндпоинты для отчетов

#### GET /reports/summary
Генерирует сводный отчет по документам

#### GET /reports/detailed
Генерирует детальный отчет по документам

#### GET /reports/fiscal
Генерирует отчет для FISC (налоговой службы Молдовы)

#### GET /reports/export
Экспортирует отчет в различных форматах

### Служебные эндпоинты

#### GET /health
Проверка состояния сервиса

#### GET /config
Возвращает текущую конфигурацию приложения (только в режиме отладки)

#### GET /docs
Автоматическая документация API (Swagger UI)

## 🏗️ Архитектура

```
back/
├── main.py                    # Основной файл приложения
├── config.py                  # Конфигурация приложения
├── document_classifier.py     # Классификатор молдавских документов
├── document_storage.py        # Хранилище документов (SQLite)
├── report_generator.py        # Генератор отчетов
├── requirements.txt           # Зависимости Python
├── README.md                 # Документация
├── templates/                # HTML шаблоны
│   └── index.html           # Главная страница
├── uploads/                 # Временная директория для файлов
├── documents.db             # База данных SQLite
├── app.log                  # Логи приложения
└── .env                     # Переменные окружения (OpenAI API ключ)
```

### Модули системы

#### 📄 document_classifier.py
- **MoldovanDocumentClassifier**: Классификация молдавских документов
- **DocumentData**: Структура данных документа
- **DocumentField**: Поле документа с извлеченным значением
- Поддержка 6 типов молдавских документов
- Валидация реквизитов (IDNO, даты, суммы)

#### 💾 document_storage.py
- **DocumentStorage**: Хранилище документов в SQLite
- **StoredDocument**: Сохраненный документ в БД
- Поиск по различным критериям
- Статистика и аналитика

#### 📊 report_generator.py
- **ReportGenerator**: Генератор отчетов
- Экспорт в Excel, CSV, JSON
- Специальные отчеты для FISC
- Форматирование и стилизация

#### ⚙️ config.py
- Централизованная конфигурация
- Настройки Tesseract и OpenAI
- Параметры приложения
- Валидация конфигурации

## 🔧 Конфигурация

### Настройка Tesseract

Если Tesseract не найден автоматически, раскомментируйте и измените строку в `config.py`:

```python
# Для macOS с Homebrew
TESSERACT_PATH = '/opt/homebrew/bin/tesseract'

# Для Windows
TESSERACT_PATH = r'C:\Program Files\Tesseract-OCR\tesseract.exe'
```

### Параметры приложения

В файле `config.py` можно настроить:

- `MAX_FILE_SIZE`: Максимальный размер файла (по умолчанию 10MB)
- `ALLOWED_EXTENSIONS`: Разрешенные форматы файлов
- `UPLOADS_DIR`: Директория для временных файлов
- `OPENAI_MODEL`: Модель OpenAI для Vision API

## 🐛 Логирование

Приложение ведет подробные логи в файл `app.log`:

- Информация о загруженных файлах
- Процесс OCR обработки
- Результаты классификации
- Ошибки и предупреждения

## 🔒 Безопасность

- Валидация типов файлов
- Ограничение размера файлов
- Автоматическое удаление временных файлов
- CORS настройки для веб-интерфейса

## 🧪 Тестирование

Запуск тестов:
```bash
python test_new_features.py
```

Тестирование API:
```bash
python test_main.py
```

## 📚 Дополнительная информация

- API документация: http://localhost:8000/docs
- Веб-интерфейс: http://localhost:8000/
- Проверка состояния: http://localhost:8000/health

## 🤝 Вклад в проект

1. Форкните репозиторий
2. Создайте ветку для новой функции
3. Внесите изменения
4. Создайте Pull Request

## 📄 Лицензия

MIT License 
=======
# SummerHackthon2025
>>>>>>> 7f04aa4af3bff061a2782446281326e84f483005
